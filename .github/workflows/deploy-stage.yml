name: deploy

on:
  push:
    branch:
      - master
  workflow_dispatch:

# It is important to specify "concurrency" for the workflow,
# to prevent concurrency between different deploys.
concurrency: Staging

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: Staging

    steps:
      - uses: actions/checkout@v2

      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.1'


      - name: Install dependencies
        run: |
          composer install --no-dev --no-progress --optimize-autoloader

      # then deploy this build to target with rsync
      - name: Deploy
        uses: deployphp/action@v1
        with:
          dep: deploy stage
          private-key: ${{ -----BEGIN OPENSSH PRIVATE KEY-----
  b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFQAAAAdzc2gtcn
  NhAAAAASUAAAEBALuOltFBZdBjiWGJvUmBO+86Fs1YmLkJn6L55vGMzPmmypj3nZjcxZVx
  46qAVVgrXw+bOxEDcoXzQRy7SN6cy9Pu/XZIp1rPv89G0bRq+uFdTeT9xsQItjGWeuTMo3
  4p0u4BNBSgOSCJ2WNubmvXK+zseli70UsyzPeDsku9DrwQLeNGu47tOTAUUNKFttVIFBmZ
  7q53vYUJAxF7vHHDaGraVWzxhVISadmkdkJoRL/BBluwOIvZRvE2OBTWB8i71yT5dYUl5U
  0c7ZuirBrTGX4c3wQ913K8SfBZkuHyMsrBsgKkQpIUUAxS2OcCnWBhyaIwMmE9RIBtRrt/
  u+8Ve/0AAAO4xAqHn8QKh58AAAAHc3NoLXJzYQAAAQEAu46W0UFl0GOJYYm9SYE77zoWzV
  iYuQmfovnm8YzM+abKmPedmNzFlXHjqoBVWCtfD5s7EQNyhfNBHLtI3pzL0+79dkinWs+/
  z0bRtGr64V1N5P3GxAi2MZZ65MyjfinS7gE0FKA5IInZY25ua9cr7Ox6WLvRSzLM94OyS7
  0OvBAt40a7ju05MBRQ0oW21UgUGZnurne9hQkDEXu8ccNoatpVbPGFUhJp2aR2QmhEv8EG
  W7A4i9lG8TY4FNYHyLvXJPl1hSXlTRztm6KsGtMZfhzfBD3XcrxJ8FmS4fIyysGyAqRCkh
  RQDFLY5wKdYGHJojAyYT1EgG1Gu3+77xV7/QAAAAElAAABAQCiNiGSYhLdvd6Zi+H6Ye6l
  Yqvv3eveTYMlKyiZjofDKHfePfAVgKriHU9HWjv5OkRghkDsHqg8f1roap/jH9LgzrGyaF
  ljS+Qo402VHkDC6OlsGcCpiv5wE3E0lU8hAZPUwsVCRWHW88LuNf6idOe4JnemsEZO39Pc
  /Ecsvy9WiQ1TEdD7weL1y0EfZZy3gdgP3/2hGyNPGGs3tNSMzj/fY9grcrKSVqVl3OjooY
  2PBT6fZ+WbDVDZVkyhQcdw8mkBy8QoGqCy2mf2pKp53oDXNjluT7SSvuZkIyyYtk4/VmqD
  Y38261Kw7v7W7b6/WONhxvI9aoDyy4nsoIgM9NetAAAAgQCCCnLrVuZtYTg8Ag6Ki/6lAK
  U0JiLfBZ/B7+sFpBijJR4xAFA6C2TIWSdfcP/cuuDCYqrVNXalrq2nDmrpR5UdQ34bGxjF
  XD06+PD1ykBtQCS01WyXrmCI0efioO1ZxwbXytgjcbnihq/Q9oV6XqQyOZ9Bu0MzbgHVbq
  TrnJiLYgAAAIEA4nGgQjpgMiV2799nuDbOVgilYorGDYy3MsgwsZp+jE/pnyHHGyIU+kcm
  Li9RgDP8DTfmi86LwgRLWgvXkaVzNN/kNrn1TYRZE+LGcYKpc2KWAMKf5Y4/Kjg7fKTgHG
  R/2kw81dQSo+f80ewin55H3tKnGuciHVGuJgWtXFRdxdkAAACBANQJmd+xdNieal2m0IFq
  S5w+mY7hak8k3ZRQ4fUUdmJApURY7cu2yUBUttrGG/jeZui7eYtCBh9xnxVuimeIsFjbAa
  P80c3591GDrdV7QGEisCvaEcka0GVUVWqsf0vtBeyOfGGmgZSHwbBSXRk02yPmew9jGAIW
  A8k8OMJLvJzFAAAAAAECAw==
  -----END OPENSSH PRIVATE KEY----- }}
        env:
          STAGING_SSH_HOST: ${{ 901046.jweiland-hosting.de }}
          STAGING_SSH_USER: ${{ u901046 }}
